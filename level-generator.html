<!DOCTYPE html>
<head>
	<script type="text/javascript" src="lib/impact/impact.js"></script>
	<script type="text/javascript" src="lib/levelgen/levelgen.js"></script>
	<script>
		window.onload = function() {
			ig.system = new ig.System( '#canvas', 1, 640, 640, 1 );
			ig.soundManager = new ig.SoundManager();
			ig.ready = true;

			var loader = new lg.Loader( lg.Levelgen, ig.resources );
			var levelgen = new lg.Levelgen( ig.system.context );
			loader.load();

			var t = setInterval( function() {
				if( loader.done ) {
					levelgen.drawLevel();
					clearInterval( t );
				}
			}, 1 );

			document.getElementById( 'btn_generate' ).onclick = genLevel;

			var canvas = document.getElementById( 'canvas' );
			canvas.ondragover = function() { return false; }
			canvas.ondragenter = function() { return false; }
			canvas.ondrop = function( e ) {
				e.preventDefault();

				var file = e.dataTransfer.files[0];
				var reader = new FileReader();

				reader.onloadend = function( e, file ) {
					dataReceived( this.result );
				};

				reader.readAsDataURL( file );
			};

			document.body.onpaste = function( e ) {
				e.preventDefault();

				var file = e.clipboardData.items[0].getAsFile();
				var reader = new FileReader();

				reader.onload = function( e, file ) {
					dataReceived( this.result );
				}

				reader.readAsDataURL( file );
			};

			function dataReceived( data ) {
				var img = new Image();
				img.src = data;
				img.onload = function() {
					levelgen.template.data = img;
					genLevel();
				}
			}

			function genLevel() {
				var value = function( e ) { return Number(document.getElementById( e ).value); }
				var checked = function( e ) { return document.getElementById( e ).checked; }
				var params = {};

				params.speed = 5;
				params.width = 40;

				params.capEnds = checked( 'chk_capEnds' );
				params.genNodes = checked( 'chk_genNodes' );

				params.deadZones = checked( 'chk_deadZones' );
				params.deadZoneChance = value( 'txt_deadZoneChance' );
				params.deadZoneRange = {};
				params.deadZoneRange.a = value( 'txt_deadZoneRangeA' );
				params.deadZoneRange.b = value( 'txt_deadZoneRangeB' );

				params.nodePadding = value( 'txt_nodePadding' );
				params.nodePaddingMin = value( 'txt_nodePaddingMin' );
				params.nodeStraitChance = value( 'txt_nodeStraitChance' );
				params.nodeCornerChance = value( 'txt_nodeCornerChance' );
				params.node3wayChance = value( 'txt_node3wayChance' );
				params.node4wayChance = value( 'txt_node4wayChance' );

				levelgen.drawLevel( params );
			}
		}
	</script>
	<style>
		body { 
			padding: 0; 
			margin: 0; 
			background: #12171c; 
			color: #dae1ec;
			font: 10pt/1.1em sans-serif;
		}
		p {
			margin: 0;
		}
		h1 {
			margin-bottom: 32px;
		}
		.wrapper {
			width: 1200px;
			height: 800px;
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			margin: auto;
			overflow: hidden;
		}
		.canvas {
			float: left;
			background: rgba(0,0,0,0.35);
			padding: 16px;
		}
		.controls {
			float: left;
			background: #242e3b;
			margin: 0 0 0 16px;
			padding: 16px;
		}
		input.small {
			width: 30px;
			text-align: center;
		}
		input[type=text] {
			padding: 0;
			border: 0;
			background: #dae1ec;
			border: solid 1px #12171c;
			font: 9pt sans-serif;
		}
		input[type=checkbox] {
			margin: 3px 9px 3px 10px;
		}
	</style>
</head>
<body>
	<div class="wrapper">
		<h1>Node Controller Level Generator</h1>
			<div class="canvas">
				<canvas id="canvas" width="640" height="640"></canvas>
			</div>
			<div class="controls">
				<form>
					<h3>Generation Settings</h3>
					<p>...</p>

					<h3>Dead Zone Settings</h3>
					<p><input type="checkbox" id="chk_deadZones" /> <label for="chk_deadZones">Generate dead zones</label></p>
					<p><input type="text" id="txt_deadZoneChance" class="small" value="0.05" /> <label for="txt_deadZoneChance">Dead zone chance</label> </p>
					<p>
						<input type="text" id="txt_deadZoneRangeA" class="small" value="0.45" />
						<input type="text" id="txt_deadZoneRangeB" class="small" value="0.55" />
						<label for="txt_deadZoneRangeA">Dead zone range</label> 
					</p>

					<h3>Network generation</h3>
					<p><input type="checkbox" id="chk_capEnds" checked /> <label for="chk_capEnds">Cap ends with nodes</label></p>

					<h3>Node generation</h3>
					<p><input type="checkbox" id="chk_genNodes" checked /> <label for="chk_genNodes">Generate nodes</label></p>
					<p>
						<input type="text" id="txt_nodePaddingMin" class="small" value="1" />
						<input type="text" id="txt_nodePadding" class="small" value="2" /> 
						<label for="txt_nodePadding">Node spacing (min/max)</label> 
					</p>
					<p><input type="text" id="txt_nodeStraitChance" class="small" value="0.25" /> <label for="txt_nodeStraitChance">Strait chance</label> </p>
					<p><input type="text" id="txt_nodeCornerChance" class="small" value="0.45" /> <label for="txt_nodeCornerChance">Corner chance</label> </p>
					<p><input type="text" id="txt_node3wayChance" class="small" value="0.65" /> <label for="txt_node3wayChance">3-way chance</label> </p>
					<p><input type="text" id="txt_node4wayChance" class="small" value="0.85" /> <label for="txt_node4wayChance">4-way chance</label> </p>


					<br />
					<p><input type="button" id="btn_generate" value="Generate"/></p>
				</form>
			</div>
	</div>
</body>